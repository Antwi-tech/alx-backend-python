#!/bin/bash
# Blue-Green Deployment Script

# Apply blue deployment (current)
kubectl apply -f messaging_app/blue_deployment.yaml

# Apply green deployment (new version)
kubectl apply -f messaging_app/green_deployment.yaml

# Apply service (initially pointing to blue)
kubectl apply -f messaging_app/kubeservice.yaml

echo "Blue and Green deployments applied."

# Check pods
kubectl get pods -l app=django-app

# Tail logs of green pods to verify no errors
GREEN_PODS=$(kubectl get pods -l app=django-app,version=green -o jsonpath='{.items[*].metadata.name}')

for pod in $GREEN_PODS; do
  echo "Logs for $pod:"
  kubectl logs $pod | tail -n 20
done

echo "To switch traffic to GREEN, edit kubeservice.yaml and change 'version: blue' â†’ 'version: green', then run:"
echo "kubectl apply -f messaging_app/kubeservice.yaml"

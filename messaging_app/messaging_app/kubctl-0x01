#!/bin/bash
# Script to scale Django app deployment and verify pods
# Requirements: kubectl, wrk, and metrics-server installed in the cluster

set -e

DEPLOYMENT_NAME="django-messaging-app"   # Change if your deployment has a different name
NAMESPACE="default"                      # Change if using another namespace

echo "ðŸ“Œ Scaling deployment $DEPLOYMENT_NAME to 3 replicas..."
kubectl scale deployment $DEPLOYMENT_NAME --replicas=3 -n $NAMESPACE

echo "âœ… Verifying pods are running..."
kubectl get pods -n $NAMESPACE

echo "ðŸ“Œ Performing load test on the Django service..."
# Replace service-name and port with your actual service name and port
SERVICE_IP=$(minikube service $DEPLOYMENT_NAME --url | head -n1)
wrk -t2 -c10 -d30s "$SERVICE_IP"

echo "ðŸ“Œ Monitoring resource usage..."
kubectl top pods -n $NAMESPACE
